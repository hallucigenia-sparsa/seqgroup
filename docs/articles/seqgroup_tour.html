<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>seqgroup tour • seqgroup</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="seqgroup tour">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">seqgroup</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/seqgroup_tour.html">seqgroup tour</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>seqgroup tour</h1>
                        <h4 class="author">Karoline Faust</h4>
            
            <h4 class="date">2019-09-07</h4>
      
      
      <div class="hidden name"><code>seqgroup_tour.Rmd</code></div>

    </div>

    
    
<div id="background-on-the-example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#background-on-the-example-data" class="anchor"></a>Background on the example data</h2>
<p>The example data in this tutorial are taken from an IBD study carried out by Franzosa et al. <a href="https://www.nature.com/articles/s41564-018-0306-4" class="uri">https://www.nature.com/articles/s41564-018-0306-4</a>. In this study, faecal samples from the PRISM cohort were sequenced and analysed. The PRISM cohort consists of 68 cases of Crohn’s disease (CD), 53 cases of ulcerative colitis (UC) and 34 controls, thus totalling 155 samples. Metagenomic shotgun sequencing was carried out. Relative abundances of species were estimated with species-specific marker genes using MetaPhlan2. Species below or equal to 0.1% abundance in at least five samples were excluded. CD and UC together are also referred to as inflammatory bowel disease (IBD).</p>
</div>
<div id="preparation-of-the-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation-of-the-analysis" class="anchor"></a>Preparation of the analysis</h2>
<p>We start by loading the seqgroup library.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(seqgroup)</code></pre></div>
<p>Next, we load the taxon abundances, taxon lineages, and sample metadata from the PRISM cohort. Taxon abundances and metadata have matching sample identifiers, thus the status of a sample can be looked up in the metadata table. We summarise the metadata using the summary command. This command also tells us that some metadata information are missing, for instance there are 62 missing values (NA) for fecal calprotectin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ibd_taxa"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ibd_lineages"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"ibd_metadata"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(ibd_metadata)</code></pre></div>
<pre><code>##  SRA_metagenome_name      Age        Diagnosis  Fecal.Calprotectin
##  G35127 :  1         24     : 10   CD     :68   2      : 5        
##  G35128 :  1         30     : 10   Control:34   231    : 3        
##  G35152 :  1         26     :  7   UC     :53   32     : 3        
##  G36347 :  1         29     :  7                1      : 2        
##  G36348 :  1         31     :  7                12     : 2        
##  G36349 :  1         32     :  6                (Other):78        
##  (Other):149         (Other):108                NA's   :62        
##  antibiotic immunosuppressant mesalamine steroids  
##  No  :134   No :100           No  :109   No  :122  
##  Yes : 18   Yes: 55           Yes : 44   Yes : 31  
##  NA's:  3                     NA's:  2   NA's:  2  
##                                                    
##                                                    
##                                                    
## </code></pre>
<p>In this data set, we have three groups of interest: CD, UC and control. For future analyses, it is handy to have a vector with the group memberships ready. We can extract this vector from the metadata table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">groups=<span class="kw"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(ibd_metadata<span class="op">$</span>Diagnosis)</code></pre></div>
</div>
<div id="exploration-of-diversity" class="section level2">
<h2 class="hasAnchor">
<a href="#exploration-of-diversity" class="anchor"></a>Exploration of diversity</h2>
<p>The first question when exploring a data set of microbial abundances is often whether groups have significantly different alpha or beta diversity. Seqgroup offers the compareGroups function to compare alpha and beta diversity across groups. Alpha diversity is assessed with the Shannon index, whereas beta diversity can be assessed for instance by comparing the Bray Curtis dissimilarity distribution. The number of samples considered for each group is by default equalised by randomly subsampling groups to the smallest group. Here, the alpha diversity of the control group is significantly higher while its beta diversity is significantly lower compared to the two IBD groups according to the unpaired Wilcoxon test. Function stat_compare_means from the R package ggpubr is used to plot the p-value on top of the distributions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/compareGroups.html">compareGroups</a></span>(ibd_taxa,<span class="dt">groups=</span>groups,<span class="dt">property=</span><span class="st">"alpha"</span>,<span class="dt">pvalViz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] "Constraining sample number randomly to the same minimal group sample number of 34"
## [1] "Processing group CD"
## [1] "Processing group UC"
## [1] "Processing group Control"
## [1] "Number of significant differences in property alpha across groups: 2"</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/compareGroups.html">compareGroups</a></span>(ibd_taxa,<span class="dt">groups=</span>groups,<span class="dt">property=</span><span class="st">"beta"</span>,<span class="dt">pvalViz =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] "Constraining sample number randomly to the same minimal group sample number of 34"
## [1] "Processing group CD"
## [1] "Processing group UC"
## [1] "Processing group Control"
## [1] "Number of significant differences in property beta across groups: 3"</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-4-2.png" width="576" style="display: block; margin: auto;"></p>
<p>The assessment of significance of a difference in beta diversity using the Bray Curtis distribution is problematic, since the number of all possible sample pairs is so large that even small differences become significant. Alternatively, we can assess beta diversity by fitting the Dirichlet-Multinomial to group-specific sample sets and compare the overdispersion parameter theta. In this case, the overdisperson supports the results obtained by comparing the Bray-Curtis distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/compareGroups.html">compareGroups</a></span>(ibd_taxa,<span class="dt">groups=</span>groups,<span class="dt">property=</span><span class="st">"beta"</span>,<span class="dt">method=</span><span class="st">"DM"</span>)</code></pre></div>
<pre><code>## [1] "Abundances have been scaled with factor: 10000"
## [1] "Constraining sample number randomly to the same minimal group sample number of 34"
## [1] "Processing group CD"
## [1] "Processing group UC"
## [1] "Processing group Control"
## NULL</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-5-1.png" width="288" style="display: block; margin: auto;"></p>
</div>
<div id="taxon-composition" class="section level2">
<h2 class="hasAnchor">
<a href="#taxon-composition" class="anchor"></a>Taxon composition</h2>
<p>Taxon composition is conveniently visualised by sorting taxa by abundance, for instance by their sum across samples, and then displaying only the top 10 or 15 taxa. We can do this for a single group. In the bar plot below, we can see that despite representing relative abundances, samples do not sum to one, because of the filtering step mentioned above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">control.indices=<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(groups<span class="op">==</span><span class="st">"Control"</span>)
<span class="kw"><a href="../reference/groupBarplot.html">groupBarplot</a></span>(ibd_taxa[,control.indices],<span class="dt">topTaxa =</span> <span class="dv">15</span>,<span class="dt">legend.shift =</span> <span class="fl">1.5</span>, <span class="dt">main=</span><span class="st">"Control"</span>)</code></pre></div>
<p><img src="figure_seqgroup_tour/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We can display the same randomly selected number of samples for the three groups. However, the taxa are now ranked by their sum across all samples, instead of being ranked per group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/groupBarplot.html">groupBarplot</a></span>(ibd_taxa,<span class="dt">topTaxa =</span> <span class="dv">15</span>,<span class="dt">groups=</span>groups, <span class="dt">randSampleNum =</span> <span class="dv">10</span>, <span class="dt">legend.shift =</span> <span class="fl">1.5</span>, <span class="dt">main=</span><span class="st">"Taxon composition"</span>)</code></pre></div>
<pre><code>## [1] "Number of samples in group CD : 68"
## [1] "Number of samples in group UC : 53"
## [1] "Number of samples in group Control : 34"</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>We can obtain a group-specific ranking and preserve the color code using extendTaxonColorMap. This illustrates that IBD samples have different top-abundant taxa than control samples do.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ibd.indices=<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(groups<span class="op">==</span><span class="st">"UC"</span>),<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(groups<span class="op">==</span><span class="st">"CD"</span>))
<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">1</span>))
taxon.color.map=<span class="kw"><a href="../reference/groupBarplot.html">groupBarplot</a></span>(ibd_taxa[,control.indices],<span class="dt">topTaxa =</span> <span class="dv">7</span>, <span class="dt">randSampleNum =</span> <span class="dv">20</span>, <span class="dt">extendTaxonColorMap =</span> <span class="ot">TRUE</span>, <span class="dt">main=</span><span class="st">"Control"</span>)</code></pre></div>
<pre><code>## [1] "Number of samples in group all : 34"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxon.color.map=<span class="kw"><a href="../reference/groupBarplot.html">groupBarplot</a></span>(ibd_taxa[,ibd.indices],<span class="dt">topTaxa =</span> <span class="dv">7</span>, <span class="dt">randSampleNum =</span> <span class="dv">20</span>, <span class="dt">taxon.color.map =</span> taxon.color.map, <span class="dt">extendTaxonColorMap =</span> <span class="ot">TRUE</span>, <span class="dt">main=</span><span class="st">"IBD"</span>)</code></pre></div>
<pre><code>## [1] "Number of samples in group all : 121"</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>))</code></pre></div>
<p>We can also obtain a complementary view on the taxon composition with phyloseq, which is supported by seqgroup.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(phyloseq)
prism.obj=<span class="kw"><a href="../reference/toPhyloseq.html">toPhyloseq</a></span>(ibd_taxa,<span class="dt">metadata=</span>ibd_metadata,<span class="dt">lineages=</span>ibd_lineages)
p =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/phyloseq/man/plot_bar.html">plot_bar</a></span>(prism.obj, <span class="st">"Order"</span>, <span class="dt">fill=</span><span class="st">"Order"</span>, <span class="dt">facet_grid=</span><span class="op">~</span>Diagnosis) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Order, <span class="dt">fill=</span>Order), <span class="dt">stat=</span><span class="st">"identity"</span>, <span class="dt">position=</span><span class="st">"stack"</span>)
p</code></pre></div>
<p><img src="figure_seqgroup_tour/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="ordination" class="section level2">
<h2 class="hasAnchor">
<a href="#ordination" class="anchor"></a>Ordination</h2>
<p>To check whether samples group by community composition, an ordination is frequently carried out. In seqgroup, vegan’s ordination functions are used to do bi- and triplots.</p>
<p>A biplot is a plot that shows both samples and taxa in the same ordination. The function seqPCoA displays significantly co-varying taxa among the selected number of taxa having the strongest covariance. The resulting plot shows that control samples are grouped separately from most IBD samples as seen in Figure 1c in Franzosa et al. <a href="https://www.nature.com/articles/s41564-018-0306-4" class="uri">https://www.nature.com/articles/s41564-018-0306-4</a>. Bray-Curtis is robust to co-absences, which bias other measures of dissimilarity/distance. This can be tested by applying a prevalence filter and repeating the plot. The sample groups are preserved, however the strongly covarying taxa are altered, since the prevalence filter removes taxa.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/seqPCoA.html">seqPCoA</a></span>(ibd_taxa,<span class="dt">groups=</span>groups, <span class="dt">topTaxa=</span><span class="dv">30</span>)</code></pre></div>
<p><img src="figure_seqgroup_tour/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## [1] "Among the top 30 covarying taxa, 2 are significant."</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># prevalence filter</span>
prev=<span class="dv">50</span> <span class="co"># minimum occurrence in 50 samples</span>
ibd_taxa_incidence=ibd_taxa
ibd_taxa_incidence[ibd_taxa_incidence<span class="op">&gt;</span><span class="dv">0</span>]=<span class="dv">1</span>
rowSums=<span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(ibd_taxa_incidence)
indices.prev=<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(rowSums<span class="op">&gt;=</span>prev)
<span class="kw"><a href="../reference/seqPCoA.html">seqPCoA</a></span>(ibd_taxa[indices.prev,], <span class="dt">groups=</span>groups, <span class="dt">topTaxa=</span><span class="dv">30</span>)</code></pre></div>
<p><img src="figure_seqgroup_tour/unnamed-chunk-10-2.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## [1] "Among the top 30 covarying taxa, 3 are significant."</code></pre>
<p>In a triplot, covarying metadata are plotted in addition. Seqgroup wraps vegan’s envfit function to do so, which does not accept missing values. In addition, envfit needs to know whether to treat metadata as numeric or categoric. By default, they are all categoric, even age, which is better treated as numeric here. Thus, before carrying out a triplot with seqPCoA, we need to assign the correct data categories and remove metadata and/or samples with missing values. The ordination then shows that calprotectin values covary strongly and significantly with the community composition of IBD samples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assign numeric metadata types, metadata with only 2 values are treated automatically as categoric (binary).</span>
ibd_metadata=<span class="kw"><a href="../reference/assignMetadataTypes.html">assignMetadataTypes</a></span>(ibd_metadata,<span class="dt">categoric=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SRA_metagenome_name"</span>,<span class="st">"Diagnosis"</span>))</code></pre></div>
<pre><code>## [1] "Metadata SRA_metagenome_name is categoric"
## [1] "Metadata Age is numeric"
## [1] "Metadata Diagnosis is categoric"
## [1] "Metadata Fecal.Calprotectin is numeric"
## [1] "Metadata antibiotic is binary"
## [1] "Metadata immunosuppressant is binary"
## [1] "Metadata mesalamine is binary"
## [1] "Metadata steroids is binary"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove 65 samples with missing calprotectin measurements or other missing values in the metadata</span>
na.indices=<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(ibd_metadata),<span class="dt">arr.ind=</span><span class="ot">TRUE</span>)[,<span class="dv">1</span>])
indices.to.keep=<span class="kw"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(ibd_metadata),na.indices)
ibd_metadata.nafree=ibd_metadata[indices.to.keep,]
ibd_taxa.nafree=ibd_taxa[,indices.to.keep]
<span class="kw"><a href="../reference/seqPCoA.html">seqPCoA</a></span>(ibd_taxa.nafree,<span class="dt">metadata=</span>ibd_metadata.nafree,<span class="dt">groups=</span>groups[indices.to.keep],<span class="dt">topTaxa=</span><span class="dv">60</span>)</code></pre></div>
<pre><code>## [1] "1 significant numeric metadata found, in order of significance:"
## [1] "Fecal.Calprotectin"
## [1] "4 significant categoric metadata found, in order of significance:"
## [1] "Diagnosis"
## [1] "antibiotic"
## [1] "immunosuppressant"
## [1] "steroids"</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## [1] "Among the top 60 covarying taxa, 6 are significant."</code></pre>
<p>The same result is also supported by the Gower distance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/seqPCoA.html">seqPCoA</a></span>(ibd_taxa.nafree,<span class="dt">metadata=</span>ibd_metadata.nafree,<span class="dt">groups=</span>groups[indices.to.keep],<span class="dt">topTaxa=</span><span class="dv">60</span>, <span class="dt">dis=</span><span class="st">"gower"</span>,<span class="dt">xlim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">0.3</span>,<span class="fl">0.3</span>),<span class="dt">main=</span><span class="st">"Gower"</span>)</code></pre></div>
<pre><code>## [1] "1 significant numeric metadata found, in order of significance:"
## [1] "Fecal.Calprotectin"
## [1] "4 significant categoric metadata found, in order of significance:"
## [1] "Diagnosis"
## [1] "antibiotic"
## [1] "immunosuppressant"
## [1] "steroids"</code></pre>
<p><img src="figure_seqgroup_tour/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## [1] "Among the top 60 covarying taxa, 3 are significant."</code></pre>
<p>Faecalibacterium prausnitzii was found to significantly covary with community composition in the reduced missing-value free data set. We can compare its distribution in IBD and control samples. In this case, there is indeed a significant difference: the abundance of F. prausnitzii is reduced in IBD samples (high density at low abundance). Here, only a single taxon is compared across two groups, but a systematic comparison of taxon abundances across groups would require a multiple testing correction. ALDEx2 <a href="https://www.bioconductor.org/packages/release/bioc/html/ALDEx2.html" class="uri">https://www.bioconductor.org/packages/release/bioc/html/ALDEx2.html</a> is a good tool for this task.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ibd.groups=groups[indices.to.keep]
ibd.groups[ibd.groups<span class="op">==</span><span class="st">"UC"</span>]=<span class="st">"IBD"</span>
ibd.groups[ibd.groups<span class="op">==</span><span class="st">"CD"</span>]=<span class="st">"IBD"</span>
taxon=<span class="st">"Faecalibacterium_prausnitzii"</span>
<span class="kw"><a href="../reference/compareDistribs.html">compareDistribs</a></span>(ibd_taxa.nafree,<span class="dt">taxon=</span>taxon,<span class="dt">groups=</span>ibd.groups,<span class="dt">group1=</span><span class="st">"IBD"</span>,<span class="dt">group2=</span><span class="st">"Control"</span>)</code></pre></div>
<p><img src="figure_seqgroup_tour/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="sample-wise-clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-wise-clustering" class="anchor"></a>Sample-wise clustering</h2>
<p>We can check if unsupervised clustering uncovers the three groups we know. DMM clustering implemented in the DirichletMultinomial package is often used for sample-wise clustering of microbial abundances, though many alternatives exist. Here, we will use the Calinski Harabasz index implemented in the clusterCrit package to determine an optimal cluster number for DMM clustering. For this tutorial, we will test the quality of up to 6 clusters. The agreement of clusters with groups can then be inspected visually in an ordination.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clusters=<span class="kw"><a href="../reference/findClusters.html">findClusters</a></span>(ibd_taxa,<span class="dt">k=</span><span class="ot">NA</span>,<span class="dt">maxK=</span><span class="dv">6</span>,<span class="dt">qualityIndex =</span> <span class="st">"CH"</span>)
<span class="kw"><a href="../reference/seqPCoA.html">seqPCoA</a></span>(ibd_taxa,<span class="dt">groups=</span>groups,<span class="dt">clusters=</span>clusters, <span class="dt">topTaxa=</span><span class="dv">30</span>)</code></pre></div>
<p><img src="figure_seqgroup_tour/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The significance of the agreement between clusters and groups can be assessed for instance with a Chi^2 test.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clus.table =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(groups, clusters) 
<span class="kw"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span>(clus.table) </code></pre></div>
<pre><code>## 
##  Pearson's Chi-squared test
## 
## data:  clus.table
## X-squared = 37.212, df = 2, p-value = 8.31e-09</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background-on-the-example-data">Background on the example data</a></li>
      <li><a href="#preparation-of-the-analysis">Preparation of the analysis</a></li>
      <li><a href="#exploration-of-diversity">Exploration of diversity</a></li>
      <li><a href="#taxon-composition">Taxon composition</a></li>
      <li><a href="#ordination">Ordination</a></li>
      <li><a href="#sample-wise-clustering">Sample-wise clustering</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Karoline Faust.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
